GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestConfChangeSnapshotUnreliableRecoverConcurrentPartition3B|| true
=== RUN   TestConfChangeSnapshotUnreliableRecoverConcurrentPartition3B
[3] becomes leader
[3] with lastIdx 6 send hb to peers [1 2 3 4 5]  6  6  6  6
[3] with lastIdx 6 send hb to peers [1 2 3 4 5]  6  6  6  6
[3] with lastIdx 6 send hb to peers [1 2 3 4 5]  6  6  6  6
[3] with lastIdx 6 send hb to peers [1 2 3 4 5]  6  6  6  6
[3] with lastIdx 6 send hb to peers [1 2 3 4 5]  6  6  6  6
[3] propose cmd Put potential next index 7 with key 4 00000000 with value x 4 0 y
[3] propose cmd Put potential next index 8 with key 1 00000000 with value x 1 0 y
[3] propose cmd Put potential next index 9 with key 2 00000000 with value x 2 0 y
[3] propose cmd Put potential next index 10 with key 3 00000000 with value x 3 0 y
[3] propose cmd Put potential next index 11 with key 0 00000000 with value x 0 0 y
[3] has put key 4 00000000 value x 4 0 y
[3] entry index 7 current proposal:  8 9 10 11
[3] has put key 1 00000000 value x 1 0 y
[5] has put key 4 00000000 value x 4 0 y
[2] has put key 4 00000000 value x 4 0 y
[3] entry index 8 current proposal:  9 10 11
[3] has put key 2 00000000 value x 2 0 y
[5] has put key 1 00000000 value x 1 0 y
[2] has put key 1 00000000 value x 1 0 y
[3] entry index 9 current proposal:  10 11
[3] has put key 3 00000000 value x 3 0 y
[5] has put key 2 00000000 value x 2 0 y
[2] has put key 2 00000000 value x 2 0 y
[3] entry index 10 current proposal:  11
[3] has put key 0 00000000 value x 0 0 y
[5] has put key 3 00000000 value x 3 0 y
[2] has put key 3 00000000 value x 3 0 y
[5] has put key 0 00000000 value x 0 0 y
[3] entry index 11 current proposal: 
[2] has put key 0 00000000 value x 0 0 y
[3] propose cmd Snap potential next index 12
[3] propose cmd Snap potential next index 13
[3] propose cmd Put potential next index 14 with key 2 00000001 with value x 2 1 y
[3] propose cmd Put potential next index 15 with key 3 00000001 with value x 3 1 y
[3] propose cmd Put potential next index 16 with key 0 00000001 with value x 0 1 y
[4] has put key 4 00000000 value x 4 0 y
[1] has put key 4 00000000 value x 4 0 y
[3] entry index 12 current proposal:  13 14 15 16
[3] entry index 13 current proposal:  14 15 16
[3] has put key 2 00000001 value x 2 1 y
[4] has put key 1 00000000 value x 1 0 y
[1] has put key 1 00000000 value x 1 0 y
[3] entry index 14 current proposal:  15 16
[3] has put key 3 00000001 value x 3 1 y
[4] has put key 2 00000000 value x 2 0 y
[5] has put key 2 00000001 value x 2 1 y
[1] has put key 2 00000000 value x 2 0 y
[3] entry index 15 current proposal:  16
[3] has put key 0 00000001 value x 0 1 y
[4] has put key 3 00000000 value x 3 0 y
[5] has put key 3 00000001 value x 3 1 y
[1] has put key 3 00000000 value x 3 0 y
[3] entry index 16 current proposal: 
[4] has put key 0 00000000 value x 0 0 y
[5] has put key 0 00000001 value x 0 1 y
[1] has put key 0 00000000 value x 0 0 y
[3] propose cmd Put potential next index 17 with key 4 00000001 with value x 4 1 y
[3] propose cmd Snap potential next index 18
[3] with lastIdx 18 send hb to peers [1 2 3 4 5]  16  16  16  16
[3] propose cmd Put potential next index 19 with key 2 00000002 with value x 2 2 y
[3] propose cmd Snap potential next index 20
[3] propose cmd Put potential next index 21 with key 0 00000002 with value x 0 2 y
[2] has put key 2 00000001 value x 2 1 y
[4] has put key 2 00000001 value x 2 1 y
[1] has put key 2 00000001 value x 2 1 y
[3] has put key 4 00000001 value x 4 1 y
[2] has put key 3 00000001 value x 3 1 y
[4] has put key 3 00000001 value x 3 1 y
[2] has put key 0 00000001 value x 0 1 y
[1] has put key 3 00000001 value x 3 1 y
[5] has put key 4 00000001 value x 4 1 y
[3] entry index 17 current proposal:  18 19 20 21
[3] entry index 18 current proposal:  19 20 21
[3] has put key 2 00000002 value x 2 2 y
[4] has put key 0 00000001 value x 0 1 y
[5] has put key 2 00000002 value x 2 2 y
[1] has put key 0 00000001 value x 0 1 y
[3] entry index 19 current proposal:  20 21
[3] entry index 20 current proposal:  21
[3] has put key 0 00000002 value x 0 2 y
[5] has put key 0 00000002 value x 0 2 y
[3] entry index 21 current proposal: 
[2] has put key 4 00000001 value x 4 1 y
[3] with lastIdx 21 send hb to peers [1 2 3 4 5]  21  21  21  21
[3] propose cmd Put potential next index 22 with key 4 00000002 with value x 4 2 y
[3] propose cmd Put potential next index 23 with key 1 00000001 with value x 1 1 y
[3] propose cmd Snap potential next index 24
[3] propose cmd Put potential next index 25 with key 3 00000002 with value x 3 2 y
[3] propose cmd Put potential next index 26 with key 0 00000003 with value x 0 3 y
[2] has put key 2 00000002 value x 2 2 y
[2] has put key 0 00000002 value x 0 2 y
[4] has put key 4 00000001 value x 4 1 y
[1] has put key 4 00000001 value x 4 1 y
[3] has put key 4 00000002 value x 4 2 y
[4] has put key 2 00000002 value x 2 2 y
[1] has put key 2 00000002 value x 2 2 y
[5] has put key 4 00000002 value x 4 2 y
[3] entry index 22 current proposal:  23 24 25 26
[3] has put key 1 00000001 value x 1 1 y
[4] has put key 0 00000002 value x 0 2 y
[1] has put key 0 00000002 value x 0 2 y
[5] has put key 1 00000001 value x 1 1 y
[3] entry index 23 current proposal:  24 25 26
[3] entry index 24 current proposal:  25 26
[3] has put key 3 00000002 value x 3 2 y
[5] has put key 3 00000002 value x 3 2 y
[3] entry index 25 current proposal:  26
[3] has put key 0 00000003 value x 0 3 y
[5] has put key 0 00000003 value x 0 3 y
[3] entry index 26 current proposal: 
[4] has put key 4 00000002 value x 4 2 y
[4] has put key 1 00000001 value x 1 1 y
[3] with lastIdx 26 send hb to peers [1 2 3 4 5]  26  21  26  26
[3] propose cmd Put potential next index 27 with key 4 00000003 with value x 4 3 y
[3] propose cmd Put potential next index 28 with key 1 00000002 with value x 1 2 y
[3] propose cmd Snap potential next index 29
[3] propose cmd Put potential next index 30 with key 3 00000003 with value x 3 3 y
[3] propose cmd Snap potential next index 31
[4] has put key 3 00000002 value x 3 2 y
[4] has put key 0 00000003 value x 0 3 y
[2] has put key 4 00000002 value x 4 2 y
[3] with lastIdx 31 send hb to peers [1 2 3 4 5]  26  27  26  26
[2] has put key 1 00000001 value x 1 1 y
[2] has put key 3 00000002 value x 3 2 y
[2] has put key 0 00000003 value x 0 3 y
[3] with lastIdx 31 send hb to peers [1 2 3 4 5]  26  31  26  26
[3] propose cmd ChangePeer potential next index 32
[3] with lastIdx 32 send hb to peers [1 2 3 4 5]  26  32  26  26
[3] propose cmd ChangePeer potential next index 33
[3] with lastIdx 32 send hb to peers [1 2 3 4 5]  26  32  26  26
[3] propose cmd ChangePeer potential next index 33
[4] becomes leader
[1] has put key 4 00000002 value x 4 2 y
[1] has put key 1 00000001 value x 1 1 y
[1] has put key 3 00000002 value x 3 2 y
[1] has put key 0 00000003 value x 0 3 y
[3] with lastIdx 32 send hb to peers [1 2 3 4 5]  26  32  26  26
[4] propose cmd ChangePeer potential next index 28
[3] propose cmd ChangePeer potential next index 33
[4] with lastIdx 28 send hb to peers [1 2 3 4]  28  5  5
[3] with lastIdx 32 send hb to peers [1 2 3 4 5]  26  32  26  26
[4] propose cmd ChangePeer potential next index 29
[3] propose cmd ChangePeer potential next index 33
[4] with lastIdx 29 send hb to peers [1 2 3 4]  29  5  5
[3] with lastIdx 32 send hb to peers [1 2 3 4 5]  26  32  26  26
[3] propose cmd ChangePeer potential next index 33
[4] propose cmd ChangePeer potential next index 30
[4] with lastIdx 29 send hb to peers [1 2 3 4]  29  5  5
[3] with lastIdx 32 send hb to peers [1 2 3 4 5]  26  32  26  26
[3] propose cmd ChangePeer potential next index 33
[4] propose cmd ChangePeer potential next index 30
[4] with lastIdx 29 send hb to peers [1 2 3 4]  29  5  5
[4] propose cmd ChangePeer potential next index 30
[4] with lastIdx 29 send hb to peers [1 2 3 4]  29  5  5
[4] propose cmd ChangePeer potential next index 30
can't call command header:<region_id:1 peer:<id:3 store_id:3 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Put put:<cf:"default" key:"4 00000003" value:"x 4 3 y" > >  on leader 3 of region 1
[4] propose cmd Put potential next index 30 with key 4 00000003 with value x 4 3 y
can't call command header:<region_id:1 peer:<id:3 store_id:3 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Put put:<cf:"default" key:"1 00000002" value:"x 1 2 y" > >  on leader 3 of region 1
[4] propose cmd Put potential next index 31 with key 1 00000002 with value x 1 2 y
can't call command header:<region_id:1 peer:<id:3 store_id:3 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 3 of region 1
[4] propose cmd Snap potential next index 32
[4] with lastIdx 32 send hb to peers [1 2 3 4]  29  5  5
can't call command header:<region_id:1 peer:<id:3 store_id:3 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Put put:<cf:"default" key:"3 00000003" value:"x 3 3 y" > >  on leader 3 of region 1
[4] propose cmd Put potential next index 33 with key 3 00000003 with value x 3 3 y
can't call command header:<region_id:1 peer:<id:3 store_id:3 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 3 of region 1
[4] propose cmd Snap potential next index 34
[4] propose cmd ChangePeer potential next index 35
[4] with lastIdx 34 send hb to peers [1 2 3 4]  29  5  5
[4] propose cmd ChangePeer potential next index 35
[4] with lastIdx 34 send hb to peers [1 2 3 4]  29  5  5
[4] propose cmd ChangePeer potential next index 35
[4] with lastIdx 34 send hb to peers [1 2 3 4]  29  5  5
[4] propose cmd ChangePeer potential next index 35
[4] with lastIdx 34 send hb to peers [1 2 3 4]  34  5  5
[4] has put key 4 00000003 value x 4 3 y
[4] entry index 30 current proposal:  31 32 33 34
[4] has put key 1 00000002 value x 1 2 y
[1] has put key 4 00000003 value x 4 3 y
[4] entry index 31 current proposal:  32 33 34
[4] entry index 32 current proposal:  33 34
[4] has put key 3 00000003 value x 3 3 y
[1] has put key 1 00000002 value x 1 2 y
[4] entry index 33 current proposal:  34
[4] entry index 34 current proposal: 
[2] has put key 4 00000003 value x 4 3 y
[1] has put key 3 00000003 value x 3 3 y
[4] propose cmd Put potential next index 35 with key 4 00000004 with value x 4 4 y
[4] propose cmd Snap potential next index 36
[4] propose cmd Put potential next index 37 with key 2 00000003 with value x 2 3 y
[4] propose cmd Snap potential next index 38
[4] propose cmd Snap potential next index 39
[2] has put key 1 00000002 value x 1 2 y
[2] has put key 3 00000003 value x 3 3 y
[4] has put key 4 00000004 value x 4 4 y
[4] entry index 35 current proposal:  36 37 38 39
[2] has put key 4 00000004 value x 4 4 y
[1] has put key 4 00000004 value x 4 4 y
[4] propose cmd Snap potential next index 40
[4] entry index 36 current proposal:  37 38 39 40
[4] has put key 2 00000003 value x 2 3 y
[2] has put key 2 00000003 value x 2 3 y
[4] entry index 37 current proposal:  38 39 40
[4] entry index 38 current proposal:  39 40
[4] entry index 39 current proposal:  40
[1] has put key 2 00000003 value x 2 3 y
[4] propose cmd Snap potential next index 41
[4] propose cmd Put potential next index 42 with key 2 00000004 with value x 2 4 y
[4] propose cmd Put potential next index 43 with key 3 00000004 with value x 3 4 y
[4] propose cmd Put potential next index 44 with key 0 00000004 with value x 0 4 y
[4] entry index 40 current proposal:  41 42 43 44
[4] propose cmd Put potential next index 45 with key 4 00000005 with value x 4 5 y
[4] entry index 41 current proposal:  42 43 44 45
[4] has put key 2 00000004 value x 2 4 y
[4] entry index 42 current proposal:  43 44 45
[4] has put key 3 00000004 value x 3 4 y
[1] has put key 2 00000004 value x 2 4 y
[2] has put key 2 00000004 value x 2 4 y
[1] has put key 3 00000004 value x 3 4 y
[4] entry index 43 current proposal:  44 45
[2] has put key 3 00000004 value x 3 4 y
[4] propose cmd Snap potential next index 46
[4] propose cmd Snap potential next index 47
[4] propose cmd Put potential next index 48 with key 3 00000005 with value x 3 5 y
[4] has put key 0 00000004 value x 0 4 y
[4] entry index 44 current proposal:  45 46 47 48
[4] has put key 4 00000005 value x 4 5 y
[1] has put key 0 00000004 value x 0 4 y
[4] entry index 45 current proposal:  46 47 48
[2] has put key 0 00000004 value x 0 4 y
[1] has put key 4 00000005 value x 4 5 y
[4] propose cmd Put potential next index 49 with key 0 00000005 with value x 0 5 y
[4] propose cmd Snap potential next index 50
[2] has put key 4 00000005 value x 4 5 y
[4] entry index 46 current proposal:  47 48 49 50
[4] entry index 47 current proposal:  48 49 50
[4] propose cmd ChangePeer potential next index 51
[4] propose cmd Put potential next index 51 with key 1 00000003 with value x 1 3 y
[4] propose cmd Snap potential next index 52
[4] has put key 3 00000005 value x 3 5 y
[2] has put key 3 00000005 value x 3 5 y
[4] entry index 48 current proposal:  49 50 51 52
[4] has put key 0 00000005 value x 0 5 y
[2] has put key 0 00000005 value x 0 5 y
[4] entry index 49 current proposal:  50 51 52
[4] entry index 50 current proposal:  51 52
[1] has put key 3 00000005 value x 3 5 y
[4] propose cmd Snap potential next index 53
[4] propose cmd Snap potential next index 54
[4] propose cmd Snap potential next index 55
[1] has put key 0 00000005 value x 0 5 y
[4] has put key 1 00000003 value x 1 3 y
[4] entry index 51 current proposal:  52 53 54 55
[4] entry index 52 current proposal:  53 54 55
[1] has put key 1 00000003 value x 1 3 y
[4] propose cmd Put potential next index 56 with key 1 00000004 with value x 1 4 y
[4] propose cmd Snap potential next index 57
[2] has put key 1 00000003 value x 1 3 y
[4] entry index 53 current proposal:  54 55 56 57
[4] propose cmd Snap potential next index 58
[4] entry index 54 current proposal:  55 56 57 58
[4] entry index 55 current proposal:  56 57 58
[4] has put key 1 00000004 value x 1 4 y
[4] entry index 56 current proposal:  57 58
[4] entry index 57 current proposal:  58
[2] has put key 1 00000004 value x 1 4 y
[1] has put key 1 00000004 value x 1 4 y
[4] propose cmd Snap potential next index 59
[4] propose cmd Snap potential next index 60
[4] propose cmd Put potential next index 61 with key 1 00000005 with value x 1 5 y
[4] propose cmd Snap potential next index 62
[4] with lastIdx 62 send hb to peers [1 2 3 4]  58  57  5
[4] entry index 58 current proposal:  59 60 61 62
[4] entry index 59 current proposal:  60 61 62
[4] entry index 60 current proposal:  61 62
[4] has put key 1 00000005 value x 1 5 y
[2] has put key 1 00000005 value x 1 5 y
[4] entry index 61 current proposal:  62
[4] entry index 62 current proposal: 
[4] propose cmd Snap potential next index 63
[4] propose cmd Snap potential next index 64
[4] propose cmd Snap potential next index 65
[4] propose cmd Snap potential next index 66
[4] propose cmd Put potential next index 67 with key 2 00000005 with value x 2 5 y
[1] has put key 1 00000005 value x 1 5 y
[4] entry index 63 current proposal:  64 65 66 67
[4] entry index 64 current proposal:  65 66 67
[4] entry index 65 current proposal:  66 67
[4] propose cmd Put potential next index 68 with key 3 00000006 with value x 3 6 y
[4] propose cmd Snap potential next index 69
[4] propose cmd Put potential next index 70 with key 0 00000006 with value x 0 6 y
[4] entry index 66 current proposal:  67 68 69 70
[4] has put key 2 00000005 value x 2 5 y
[4] entry index 67 current proposal:  68 69 70
[4] has put key 3 00000006 value x 3 6 y
[1] has put key 2 00000005 value x 2 5 y
[4] entry index 68 current proposal:  69 70
[1] has put key 3 00000006 value x 3 6 y
[2] has put key 2 00000005 value x 2 5 y
[4] propose cmd Snap potential next index 71
[4] propose cmd Snap potential next index 72
[4] propose cmd Snap potential next index 73
[2] has put key 3 00000006 value x 3 6 y
[4] entry index 69 current proposal:  70 71 72 73
[4] propose cmd Snap potential next index 74
[4] has put key 0 00000006 value x 0 6 y
[4] entry index 70 current proposal:  71 72 73 74
[4] entry index 71 current proposal:  72 73 74
[4] entry index 72 current proposal:  73 74
[4] entry index 73 current proposal:  74
[2] has put key 0 00000006 value x 0 6 y
[1] has put key 0 00000006 value x 0 6 y
[4] propose cmd Put potential next index 75 with key 2 00000006 with value x 2 6 y
[4] propose cmd Put potential next index 76 with key 1 00000006 with value x 1 6 y
[4] propose cmd Snap potential next index 77
[4] propose cmd Put potential next index 78 with key 3 00000007 with value x 3 7 y
[4] propose cmd ChangePeer potential next index 79
[4] entry index 74 current proposal:  75 76 77 78
[4] has put key 2 00000006 value x 2 6 y
[2] has put key 2 00000006 value x 2 6 y
[1] has put key 2 00000006 value x 2 6 y
[4] entry index 75 current proposal:  76 77 78
[4] has put key 1 00000006 value x 1 6 y
[2] has put key 1 00000006 value x 1 6 y
[1] has put key 1 00000006 value x 1 6 y
[1] has put key 3 00000007 value x 3 7 y
[2] has put key 3 00000007 value x 3 7 y
[4] entry index 76 current proposal:  77 78
[4] entry index 77 current proposal:  78
[4] has put key 3 00000007 value x 3 7 y
[4] entry index 78 current proposal: 
[4] propose cmd Snap potential next index 79
[4] propose cmd Put potential next index 80 with key 2 00000007 with value x 2 7 y
[4] propose cmd Put potential next index 81 with key 1 00000007 with value x 1 7 y
[4] propose cmd Snap potential next index 82
[4] propose cmd Put potential next index 83 with key 3 00000008 with value x 3 8 y
[4] entry index 79 current proposal:  80 81 82 83
[4] propose cmd Put potential next index 84 with key 4 00000006 with value x 4 6 y
[4] has put key 2 00000007 value x 2 7 y
[4] entry index 80 current proposal:  81 82 83 84
[4] has put key 1 00000007 value x 1 7 y
[1] has put key 2 00000007 value x 2 7 y
[4] entry index 81 current proposal:  82 83 84
[4] entry index 82 current proposal:  83 84
[2] has put key 2 00000007 value x 2 7 y
[2] has put key 1 00000007 value x 1 7 y
[1] has put key 1 00000007 value x 1 7 y
[4] propose cmd Put potential next index 85 with key 2 00000008 with value x 2 8 y
[4] propose cmd Snap potential next index 86
[4] propose cmd Put potential next index 87 with key 0 00000007 with value x 0 7 y
[4] has put key 3 00000008 value x 3 8 y
[4] entry index 83 current proposal:  84 85 86 87
[4] has put key 4 00000006 value x 4 6 y
[2] has put key 3 00000008 value x 3 8 y
[1] has put key 3 00000008 value x 3 8 y
[4] entry index 84 current proposal:  85 86 87
[2] has put key 4 00000006 value x 4 6 y
[1] has put key 4 00000006 value x 4 6 y
[4] propose cmd Snap potential next index 88
[4] propose cmd Put potential next index 89 with key 4 00000007 with value x 4 7 y
[4] has put key 2 00000008 value x 2 8 y
[4] entry index 85 current proposal:  86 87 88 89
[4] entry index 86 current proposal:  87 88 89
[4] has put key 0 00000007 value x 0 7 y
[2] has put key 2 00000008 value x 2 8 y
[1] has put key 2 00000008 value x 2 8 y
[4] entry index 87 current proposal:  88 89
[4] entry index 88 current proposal:  89
[4] has put key 4 00000007 value x 4 7 y
[2] has put key 0 00000007 value x 0 7 y
[1] has put key 0 00000007 value x 0 7 y
[4] entry index 89 current proposal: 
[2] has put key 4 00000007 value x 4 7 y
[1] has put key 4 00000007 value x 4 7 y
[4] propose cmd Put potential next index 90 with key 2 00000009 with value x 2 9 y
[4] propose cmd Snap potential next index 91
[4] with lastIdx 91 send hb to peers [1 2 3 4]  89  89  5
[4] propose cmd Snap potential next index 92
[4] propose cmd Put potential next index 93 with key 3 00000009 with value x 3 9 y
[4] propose cmd Snap potential next index 94
[4] has put key 2 00000009 value x 2 9 y
[1] has put key 2 00000009 value x 2 9 y
[4] entry index 90 current proposal:  91 92 93 94
[4] entry index 91 current proposal:  92 93 94
[2] has put key 2 00000009 value x 2 9 y
[4] propose cmd Snap potential next index 95
[4] propose cmd Snap potential next index 96
[4] entry index 92 current proposal:  93 94 95 96
[4] has put key 3 00000009 value x 3 9 y
[2] has put key 3 00000009 value x 3 9 y
[1] has put key 3 00000009 value x 3 9 y
[4] entry index 93 current proposal:  94 95 96
[4] entry index 94 current proposal:  95 96
[4] propose cmd Put potential next index 97 with key 0 00000008 with value x 0 8 y
[4] propose cmd Snap potential next index 98
[4] propose cmd Snap potential next index 99
[4] entry index 95 current proposal:  96 97 98 99
[4] entry index 96 current proposal:  97 98 99
[4] propose cmd Put potential next index 100 with key 1 00000008 with value x 1 8 y
[4] propose cmd Snap potential next index 101
[4] has put key 0 00000008 value x 0 8 y
[4] entry index 97 current proposal:  98 99 100 101
[1] has put key 0 00000008 value x 0 8 y
[2] has put key 0 00000008 value x 0 8 y
[4] propose cmd Put potential next index 102 with key 0 00000009 with value x 0 9 y
[4] entry index 98 current proposal:  99 100 101 102
[4] entry index 99 current proposal:  100 101 102
[4] has put key 1 00000008 value x 1 8 y
[4] entry index 100 current proposal:  101 102
[4] entry index 101 current proposal:  102
[1] has put key 1 00000008 value x 1 8 y
[2] has put key 1 00000008 value x 1 8 y
[4] propose cmd Put potential next index 103 with key 3 00000010 with value x 3 10 y
[4] propose cmd Put potential next index 104 with key 4 00000008 with value x 4 8 y
[4] propose cmd Snap potential next index 105
[4] propose cmd Snap potential next index 106
[4] has put key 0 00000009 value x 0 9 y
[4] entry index 102 current proposal:  103 104 105 106
[2] has put key 0 00000009 value x 0 9 y
[4] propose cmd Put potential next index 107 with key 0 00000010 with value x 0 10 y
[1] has put key 0 00000009 value x 0 9 y
[4] has put key 3 00000010 value x 3 10 y
[4] entry index 103 current proposal:  104 105 106 107
[2] has put key 3 00000010 value x 3 10 y
[1] has put key 3 00000010 value x 3 10 y
[4] propose cmd ChangePeer potential next index 108
[4] propose cmd Put potential next index 108 with key 3 00000011 with value x 3 11 y
[4] has put key 4 00000008 value x 4 8 y
[2] has put key 4 00000008 value x 4 8 y
[4] entry index 104 current proposal:  105 106 107 108
[4] entry index 105 current proposal:  106 107 108
[4] entry index 106 current proposal:  107 108
[4] has put key 0 00000010 value x 0 10 y
[1] has put key 4 00000008 value x 4 8 y
[4] entry index 107 current proposal:  108
[1] has put key 0 00000010 value x 0 10 y
[4] propose cmd Snap potential next index 109
[4] propose cmd Snap potential next index 110
[4] propose cmd Snap potential next index 111
[4] propose cmd Put potential next index 112 with key 0 00000011 with value x 0 11 y
[1] has put key 3 00000011 value x 3 11 y
[2] has put key 0 00000010 value x 0 10 y
[4] has put key 3 00000011 value x 3 11 y
[2] has put key 3 00000011 value x 3 11 y
[4] entry index 108 current proposal:  109 110 111 112
[4] propose cmd Snap potential next index 113
[4] entry index 109 current proposal:  110 111 112 113
[4] entry index 110 current proposal:  111 112 113
[4] entry index 111 current proposal:  112 113
[4] has put key 0 00000011 value x 0 11 y
[4] entry index 112 current proposal:  113
[1] has put key 0 00000011 value x 0 11 y
[2] has put key 0 00000011 value x 0 11 y
[4] propose cmd Snap potential next index 114
[4] propose cmd Snap potential next index 115
[4] propose cmd Put potential next index 116 with key 2 00000010 with value x 2 10 y
[4] propose cmd Snap potential next index 117
[4] entry index 113 current proposal:  114 115 116 117
[4] entry index 114 current proposal:  115 116 117
[4] entry index 115 current proposal:  116 117
[4] propose cmd Snap potential next index 118
[4] propose cmd Put potential next index 119 with key 3 00000012 with value x 3 12 y
[4] propose cmd Snap potential next index 120
[4] has put key 2 00000010 value x 2 10 y
[2] has put key 2 00000010 value x 2 10 y
[4] entry index 116 current proposal:  117 118 119 120
[4] entry index 117 current proposal:  118 119 120
[1] has put key 2 00000010 value x 2 10 y
[4] with lastIdx 120 send hb to peers [1 2 3 4]  117  117  5
[4] propose cmd CompactLog potential next index 121
[4] propose cmd Snap potential next index 122
[4] propose cmd Put potential next index 123 with key 0 00000012 with value x 0 12 y
[4] entry index 118 current proposal:  119 120 122 123
[4] has put key 3 00000012 value x 3 12 y
[4] entry index 119 current proposal:  120 122 123
[2] has put key 3 00000012 value x 3 12 y
[4] propose cmd Snap potential next index 124
[4] propose cmd Put potential next index 125 with key 3 00000013 with value x 3 13 y
[1] has put key 3 00000012 value x 3 12 y
[4] entry index 120 current proposal:  122 123 124 125
[4] entry index 122 current proposal:  123 124 125
[4] has put key 0 00000012 value x 0 12 y
[2] has put key 0 00000012 value x 0 12 y
[1] has put key 0 00000012 value x 0 12 y
[4] entry index 123 current proposal:  124 125
[4] entry index 124 current proposal:  125
[4] propose cmd Put potential next index 126 with key 4 00000009 with value x 4 9 y
[4] propose cmd Put potential next index 127 with key 2 00000011 with value x 2 11 y
[4] propose cmd Snap potential next index 128
[4] propose cmd Put potential next index 129 with key 1 00000009 with value x 1 9 y
[4] has put key 3 00000013 value x 3 13 y
[4] entry index 125 current proposal:  126 127 128 129
[2] has put key 3 00000013 value x 3 13 y
[4] propose cmd Snap potential next index 130
[1] has put key 3 00000013 value x 3 13 y
[4] has put key 4 00000009 value x 4 9 y
[4] entry index 126 current proposal:  127 128 129 130
[4] propose cmd Put potential next index 131 with key 4 00000010 with value x 4 10 y
[2] has put key 4 00000009 value x 4 9 y
[1] has put key 4 00000009 value x 4 9 y
[4] has put key 2 00000011 value x 2 11 y
[2] has put key 2 00000011 value x 2 11 y
[4] entry index 127 current proposal:  128 129 130 131
[4] entry index 128 current proposal:  129 130 131
[4] propose cmd ChangePeer potential next index 132
[4] propose cmd Snap potential next index 132
[4] propose cmd Snap potential next index 133
[1] has put key 2 00000011 value x 2 11 y
[4] has put key 1 00000009 value x 1 9 y
[4] entry index 129 current proposal:  130 131 132 133
[4] entry index 130 current proposal:  131 132 133
[2] has put key 1 00000009 value x 1 9 y
[4] propose cmd Snap potential next index 134
[4] propose cmd Put potential next index 135 with key 3 00000014 with value x 3 14 y
[4] has put key 4 00000010 value x 4 10 y
[1] has put key 1 00000009 value x 1 9 y
[2] has put key 4 00000010 value x 4 10 y
[4] entry index 131 current proposal:  132 133 134 135
[4] propose cmd Snap potential next index 136
[4] entry index 132 current proposal:  133 134 135 136
[1] has put key 4 00000010 value x 4 10 y
[4] propose cmd Put potential next index 137 with key 2 00000012 with value x 2 12 y
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
[4] propose cmd ChangePeer potential next index 138
[4] with lastIdx 137 send hb to peers [1 2 3 4]  132  137  5
can't call command header:<region_id:1 peer:<id:4 store_id:4 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 4 of region 1
can't call command header:<region_id:1 peer:<id:5 store_id:5 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 5 of region 1
can't call command header:<region_id:1 peer:<id:4 store_id:4 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Put put:<cf:"default" key:"3 00000014" value:"x 3 14 y" > >  on leader 4 of region 1
can't call command header:<region_id:1 peer:<id:4 store_id:4 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 4 of region 1
can't call command header:<region_id:1 peer:<id:4 store_id:4 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 4 of region 1
can't call command header:<region_id:1 peer:<id:5 store_id:5 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Snap snap:<> >  on leader 5 of region 1
can't call command header:<region_id:1 peer:<id:4 store_id:4 > region_epoch:<conf_ver:1 version:1 > > requests:<cmd_type:Put put:<cf:"default" key:"2 00000012" value:"x 2 12 y" > >  on leader 4 of region 1
[2] becomes leader
[2] propose cmd ChangePeer potential next index 139
[2] propose cmd Snap potential next index 140
[2] propose cmd Snap potential next index 141
[2] propose cmd Put potential next index 142 with key 3 00000014 with value x 3 14 y
[2] propose cmd Snap potential next index 143
[2] propose cmd Put potential next index 144 with key 2 00000012 with value x 2 12 y
panic: [region 1] 1 meta corrupted id:1 region_epoch:<conf_ver:2 version:1 > peers:<id:1 store_id:1 > peers:<id:2 store_id:2 > peers:<id:3 store_id:3 > peers:<id:4 store_id:4 >  != id:1 region_epoch:<conf_ver:1 version:1 > peers:<id:1 store_id:1 > peers:<id:2 store_id:2 > peers:<id:3 store_id:3 > peers:<id:4 store_id:4 > peers:<id:5 store_id:5 > 

goroutine 208 [running]:
github.com/pingcap-incubator/tinykv/kv/raftstore.(*peerMsgHandler).checkSnapshot(0xc0000b3e38, 0xc1deb81c00, 0x0, 0x0, 0x0)
	/home/spadea/STUDY/tinykv/kv/raftstore/peer_msg_handler.go:907 +0x83f
github.com/pingcap-incubator/tinykv/kv/raftstore.(*peerMsgHandler).onRaftMsg(0xc0000b3e38, 0xc1deb81c00, 0xc0000b3d40, 0xf6d27733)
	/home/spadea/STUDY/tinykv/kv/raftstore/peer_msg_handler.go:741 +0x29d
github.com/pingcap-incubator/tinykv/kv/raftstore.(*peerMsgHandler).HandleMsg(0xc0000b3e38, 0x3, 0x1, 0xba91e0, 0xc1deb81c00)
	/home/spadea/STUDY/tinykv/kv/raftstore/peer_msg_handler.go:505 +0x9c
github.com/pingcap-incubator/tinykv/kv/raftstore.(*raftWorker).run(0xc000262280, 0xc00021e4e0, 0xc00013a520)
	/home/spadea/STUDY/tinykv/kv/raftstore/raft_worker.go:56 +0x4ff
created by github.com/pingcap-incubator/tinykv/kv/raftstore.(*Raftstore).startWorkers
	/home/spadea/STUDY/tinykv/kv/raftstore/raftstore.go:270 +0xe6
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	7.760s
FAIL
